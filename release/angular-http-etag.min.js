!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("angular")):"function"==typeof define&&define.amd?define(["angular"],t):e.angularHttpEtag=t(e.angular)}(this,function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}function r(){var t=this,n=["createCache","getCache"],r=["setItem","getItem","removeItem","removeAllItems"],o=n.concat(r),c={},i={},a="httpEtagCache",u={deepCopy:!1,cacheResponseData:!0,cacheService:"$cacheFactory",cacheOptions:{number:25}};t.setDefaultCacheConfig=function(n){return u=e.extend({},u,n),t},t.getDefaultCacheConfig=function(){return u},t.defineCache=function(n,r){return r=e.extend({},u,r,{id:n}),i[n]=r,t},t.defineCacheServiceAdapter=function(n,r){if(!r)throw new Error("Missing cache service adapter configuration");if(!r.methods)throw new Error("Missing cache service adapter configuration methods");return e.forEach(o,function(e){if("function"!=typeof r.methods[e])throw new Error('Expected cache service adapter method "'+e+'" to be a function')}),c[n]=r,t},t.getCacheServiceAdapter=function(e){return c[e]},t.$get=["$injector",function(o){function u(e){var t=typeof e,n="number"===t||"string"===t&&!!e;return n?e:a}var f={},s={},l={},p={},d={};return i[a]||t.defineCache(a),e.forEach(c,function(t,r){var c=s[r]=window[r]||o.get(r),i=l[r]={};e.forEach(n,function(n){i[n]=e.bind({},t.methods[n],c)})}),e.forEach(i,function(t,n){l[t.cacheService].createCache(n,t);var o=p[n]=l[t.cacheService].getCache(n),a=d[n]={},u=c[t.cacheService].config.storesDeepCopies,s=!u&&i[n].deepCopy,h=function(e){return s?O(e):e};e.forEach(r,function(n){var r,i,u=c[t.cacheService].methods[n];"getItem"===n&&(r=function(e,t,n){var r=u(e,t,n);return r&&h(r.responseData)},i=function(e,t,n){return h(u(e,t,n))}),"setItem"===n&&(r=function(e,t,n,r){var o=a.$getItem(t);n=h(n),o&&"object"==typeof o?(o.responseData=n,n=o):n={responseData:n},u(e,t,n,r)},i=function(e,t,n,r){u(e,t,h(n),r)}),a[n]=e.bind({},r||u,o),i&&(a["$"+n]=e.bind({},i,o))}),a.unsetItem=function(e){a.setItem(e,void 0)},a.expireItem=function(e){var t=a.$getItem(e);delete t.etagHeader,a.$setItem(e,t)},a.getItemCache=function(e){return f.getItemCache(n,e)},a.info=function(){return i[n]},a.isCache=!0}),f.info=function(){return i},f.getCache=function(e){var t=d[u(e)];if(t)return t},f.getItemCache=function(t,n){var r=f.getCache(t),o={};if(r){var c=[["set","setItem"],["get","getItem"],["$set","$setItem"],["$get","$getItem"],["unset","unsetItem"],["expire","expireItem"],["remove","removeItem"]];return e.forEach(c,function(t){o[t[0]]=e.bind({},r[t[1]],n)}),o.info=function e(){var e=r.info();return e.itemKey=n,e},o.isItemCache=!0,o}},f.purgeCaches=function(){e.forEach(d,function(e){e.removeAllItems()})},f}]}function o(t,n){function r(t){function r(e){var n=e.then,o=e.success;return e.cached=function(n){return d&&m&&v.cacheResponseData&&n(b,"cached",void 0,t,g),e},e.then=function(t,o,c){function i(e){return t(e,g)}function a(e){return o(e,g)}var u=n.apply(e,[t?i:void 0,o?a:void 0,c]);return r(u)},a&&g&&(e.success=function(t){var n=u(t,void 0,void 0,void 0,void 0,g);return o.apply(e,[n])}),e}var i,a=o.useLegacyPromiseExtensions(),l=!!t.etagCache,p=s.indexOf(t.method)>=0,d=l&&p;if(d){var h=c(t);if(h){var g=n.getItemCache(h.id,h.itemKey);if(!g)throw new Error("No defined ETag caches match specified cache ID");var v=g.info(),m=g.$get(),y=m&&m.etagHeader,b=y&&m.responseData;t.$$_itemCache=g,y&&(t.headers=e.extend({},t.headers,{"If-None-Match":y}))}}return i=f.apply(f,arguments),r(i),i}function c(e){var t=e.etagCache,n=typeof t,r={};if("function"===n&&(t=t(e),n=typeof t),"object"===n){var o,c;t.isCache?(o=t.info().id,c=i(e)):t.isItemCache?(o=t.info().id,c=t.info().itemKey):(o=t.id,c=t.itemKey||i(e)),r.id=o,r.itemKey=c}else if("string"===n)r.id=t,r.itemKey=i(e);else{if(t!==!0)return;r.itemKey=i(e)}return r}function i(e){var t=e.url,n=a(e.params),r=n&&t.indexOf("?")>0?"&":"?",o=n&&r+n||"";return t+o}function a(t){return t?P(A(t).sort(),function(n){var r=t[n];return e.isArray(r)?P(r.sort(),function(e){return encodeURIComponent(n)+"="+encodeURIComponent(e)}).join("&"):encodeURIComponent(n)+"="+encodeURIComponent(r)}).join("&"):""}function u(e){var t=Array.prototype.slice.call(arguments,1);return function(){for(var n=0,r=0;r<t.length&&n<arguments.length;r++)void 0===t[r]&&(t[r]=arguments[n++]);return e.apply(this,t)}}var f=t,s=["GET","JSONP"];return e.forEach(s,function(t){var n=t.toLowerCase();r[n]=function(n,o){return o=e.extend({},o,{method:t,url:n}),r.call(f,o)}}),e.forEach(f,function(e,t){r[t]||(r[t]=e)}),r}function c(){function e(e){var t=e.config.$$_itemCache;if(t){var n=t.info(),r=n.cacheResponseData,o=e.headers().etag,c={};o&&(c.etagHeader=o,r&&(c.responseData=e.data),t.$set(c)),delete e.config.$$_itemCache}return e}return{response:e}}function i(t){t.defineCacheServiceAdapter("$cacheFactory",{config:{storesDeepCopies:!1},methods:{createCache:function(e,t,n){e(t,n)},getCache:function(e,t){return e.get(t)},setItem:function(e,t,n){e.put(t,n)},getItem:function(e,t){return e.get(t)},removeItem:function(e,t){e.remove(t)},removeAllItems:function(e,t){e.removeAll()}}}).defineCacheServiceAdapter("localStorage",{config:{storesDeepCopies:!0},methods:{createCache:e.noop,getCache:function(e,t){return t},setItem:function(e,t,n){t=e+":"+t,localStorage.setItem(t,JSON.stringify(n))},getItem:function(e,t){return t=e+":"+t,JSON.parse(localStorage.getItem(t))},removeItem:function(e,t){t=e+":"+t,localStorage.removeItem(t)},removeAllItems:function(t,n){var r=t+":";e.forEach(localStorage,function(e,t){0===t.indexOf(r)&&localStorage.removeItem(t)})}}}).defineCacheServiceAdapter("sessionStorage",{config:{storesDeepCopies:!0},methods:{createCache:e.noop,getCache:function(e,t){return t},setItem:function(e,t,n){t=e+":"+t,sessionStorage.setItem(t,JSON.stringify(n))},getItem:function(e,t){return t=e+":"+t,JSON.parse(sessionStorage.getItem(t))},removeItem:function(e,t){t=e+":"+t,sessionStorage.removeItem(t)},removeAllItems:function(t,n){var r=t+":";e.forEach(sessionStorage,function(e,t){0===t.indexOf(r)&&sessionStorage.removeItem(t)})}}})}e="default"in e?e.default:e;var a=n(function(e,t){function n(e,t){if("[object Array]"!==r.call(e))throw new TypeError("array must be an Array");var n=void 0,o=void 0,c=void 0;for(n=0,o=e.length;n<o;++n)if(c=e[n],c===t||c!==c&&t!==t)return n;return-1}t.__esModule=!0;var r=Object.prototype.toString,o="undefined"!=typeof Buffer?function(e){return Buffer.isBuffer(e)}:function(){return!1},c="function"==typeof Object.keys?function(e){return Object.keys(e)}:function(e){var t=typeof e;if(null===e||"function"!==t&&"object"!==t)throw new TypeError("obj must be an Object");var n=[],r=void 0;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(r);return n},i="function"==typeof Symbol?function(e){return Object.getOwnPropertySymbols(e)}:function(){return[]};t.getKeys=c,t.getSymbols=i,t.indexOf=n,t.isBuffer=o}),u=t(a),f=a.isBuffer,s=a.indexOf,l=a.getSymbols,p=a.getKeys,d=Object.freeze({default:u,isBuffer:f,indexOf:s,getSymbols:l,getKeys:p}),h=n(function(e,n){function r(e,t){var n=c(e);return null!==n?n:o(e,t)}function o(e,t){if("function"!=typeof t)throw new TypeError("customizer is must be a Function");if("function"==typeof e){var n=String(e);return/^\s*function\s*\S*\([^\)]*\)\s*{\s*\[native code\]\s*}/.test(n)?e:new Function("return "+String(n))()}var r=a.call(e);if("[object Array]"===r)return[];if("[object Object]"===r&&e.constructor===Object)return{};if("[object Date]"===r)return new Date(e.getTime());if("[object RegExp]"===r){var o=String(e),c=o.lastIndexOf("/");return new RegExp(o.slice(1,c),o.slice(c+1))}if((0,i.isBuffer)(e)){var u=new Buffer(e.length);return e.copy(u),u}var f=t(e);return void 0!==f?f:null}function c(e){var t=typeof e;return null!==e&&"object"!==t&&"function"!==t?e:null}n.__esModule=!0,n.copyValue=n.copyCollection=n.copy=void 0;var i=t(d),a=Object.prototype.toString;n.copy=r,n.copyCollection=o,n.copyValue=c}),g=t(h),v=h.copyValue,m=h.copyCollection,y=h.copy,b=Object.freeze({default:g,copyValue:v,copyCollection:m,copy:y}),I=n(function(e,n){function r(e){}function o(e){var t=arguments.length<=1||void 0===arguments[1]?r:arguments[1];if(null===e)return null;var n=(0,i.copyValue)(e);if(null!==n)return n;var o=(0,i.copyCollection)(e,t),a=null!==o?o:e,u=[e],f=[a];return c(e,t,a,u,f)}function c(e,t,n,r,o){if(null===e)return null;var u=(0,i.copyValue)(e);if(null!==u)return u;var f=(0,a.getKeys)(e).concat((0,a.getSymbols)(e)),s=void 0,l=void 0,p=void 0,d=void 0,h=void 0,g=void 0,v=void 0,m=void 0;for(s=0,l=f.length;s<l;++s)p=f[s],d=e[p],h=(0,a.indexOf)(r,d),g=void 0,v=void 0,m=void 0,h===-1?(g=(0,i.copy)(d,t),v=null!==g?g:d,null!==d&&/^(?:function|object)$/.test(typeof d)&&(r.push(d),o.push(v))):m=o[h],n[p]=m||c(d,t,v,r,o);return n}n.__esModule=!0;var i=t(b),a=t(d);n.default=o,e.exports=n.default}),C=t(I),j=Object.freeze({default:C}),S=n(function(e){e.exports=t(j)}),O=t(S),$=n(function(e){var t=Object.prototype.toString;e.exports=function(e){var n=t.call(e),r="[object Arguments]"===n;return r||(r="[object Array]"!==n&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),r}}),w=t($),E=Object.freeze({default:w}),x=n(function(e){var n=Object.prototype.hasOwnProperty,r=Object.prototype.toString,o=Array.prototype.slice,c=t(E),i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),u=i.call(function(){},"prototype"),f=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=function(e){var t=e.constructor;return t&&t.prototype===e},l={$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!l["$"+e]&&n.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{s(window[e])}catch(e){return!0}}catch(e){return!0}return!1}(),d=function(e){if("undefined"==typeof window||!p)return s(e);try{return s(e)}catch(e){return!1}},h=function(e){var t=null!==e&&"object"==typeof e,o="[object Function]"===r.call(e),i=c(e),s=t&&"[object String]"===r.call(e),l=[];if(!t&&!o&&!i)throw new TypeError("Object.keys called on a non-object");var p=u&&o;if(s&&e.length>0&&!n.call(e,0))for(var h=0;h<e.length;++h)l.push(String(h));if(i&&e.length>0)for(var g=0;g<e.length;++g)l.push(String(g));else for(var v in e)p&&"prototype"===v||!n.call(e,v)||l.push(String(v));if(a)for(var m=d(e),y=0;y<f.length;++y)m&&"constructor"===f[y]||!n.call(e,f[y])||l.push(f[y]);return l};h.shim=function(){if(Object.keys){var e=function(){return 2===(Object.keys(arguments)||"").length}(1,2);if(!e){var t=Object.keys;Object.keys=function(e){return t(c(e)?o.call(e):e)}}}else Object.keys=h;return Object.keys||h},e.exports=h}),A=t(x),D=n(function(e){e.exports=function(e,n){if(e.map)return e.map(n);for(var r=[],o=0;o<e.length;o++){var c=e[o];t.call(e,o)&&r.push(n(c,o,e))}return r};var t=Object.prototype.hasOwnProperty}),P=t(D);o.$inject=["$delegate","httpEtag"],i.$inject=["httpEtagProvider"];var k,K=e.module("http-etag",[]).provider("httpEtag",r).config(i).config(["$provide","$httpProvider",function(e,t){k=e,t.interceptors.push(c),o.useLegacyPromiseExtensions=t.useLegacyPromiseExtensions||function(){return!0}}]).run(function(){k.decorator("$http",o)}).name;return K});
//# sourceMappingURL=angular-http-etag.min.js.map
